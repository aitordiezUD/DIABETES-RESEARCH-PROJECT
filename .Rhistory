# In order to compute our predictions we need to fix the cut point
# Let's select cp=0.5
cp<-0.5
# Let us now use the cut point to obtain our predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
# We can now create the table
library(caret)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
# ROC
# The ROC curve is plot of the sensitivity as a function of 1-specificity
library(pROC)
par(pty="s")
Roc <- roc(response,mod1$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.05,labels = "Sensitivity")
text(x=0.7,y=0.95,labels = "Specificity")
abline(v=0.4484,col="red",lty=2)
cp = 0.4484
# Let us now use the value of the new cut point to make predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
#Let's checkout the Wald Tests.
summary(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# we can obtain the exponentials simply by
exp(mod1$coefficients)
# HOSMER-LEMESHOW TEST
# install the package first
# install.packages("ResourceSelection")
library(ResourceSelection)
# Let's obtain the pvalue
hoslem.test(d1$Smoker,mod1$fitted.values)
# CLASSIFICATION TABLE
# The table is produced with two variables: data of the response and predictions
# The response is:
response <- d1$Smoker
# In order to compute our predictions we need to fix the cut point
# Let's select cp=0.5
cp<-0.5
# Let us now use the cut point to obtain our predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
# We can now create the table
library(caret)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
# ROC
# The ROC curve is plot of the sensitivity as a function of 1-specificity
library(pROC)
par(pty="s")
Roc <- roc(response,mod1$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
Roc <- roc(response,mod1$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.05,labels = "Sensitivity")
text(x=0.7,y=0.95,labels = "Specificity")
abline(v=0.4484,col="red",lty=2)
text(x=0.7,y=0.1,labels = "Sensitivity")
text(x=0.7,y=0.9,labels = "Specificity")
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.1,labels = "Sensitivity")
text(x=0.7,y=0.9,labels = "Specificity")
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.13,labels = "Sensitivity")
text(x=0.7,y=0.9,labels = "Specificity")
cp = 0.4484
abline(v=0.4484,col="red",lty=2)
abline(v=0.41,col="red",lty=2)
cp = 0.41
# Let us now use the value of the new cut point to make predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.13,labels = "Sensitivity")
text(x=0.7,y=0.9,labels = "Specificity")
abline(v=0.415,col="red",lty=2)
abline(v=0.412,col="red",lty=2)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.13,labels = "Sensitivity")
text(x=0.7,y=0.9,labels = "Specificity")
abline(v=0.412,col="red",lty=2)
cp = 0.412
# Let us now use the value of the new cut point to make predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
mod1$coefficients
mod1 <- glm(PhysActivity ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol+Age, data = d1, family = binomial())
mod1 #No observation is deleted
#Let's checkout the Wald Tests.
summary(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# we can obtain the exponentials simply by
exp(mod1$coefficients)
# HOSMER-LEMESHOW TEST
# install the package first
# install.packages("ResourceSelection")
library(ResourceSelection)
# Let's obtain the pvalue
hoslem.test(d1$PhysActivity,mod1$fitted.values)
# CLASSIFICATION TABLE
# The table is produced with two variables: data of the response and predictions
# The response is:
response <- d1$PhysActivity
# In order to compute our predictions we need to fix the cut point
# Let's select cp=0.5
cp<-0.5
# Let us now use the cut point to obtain our predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
# We can now create the table
library(caret)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
# ROC
# The ROC curve is plot of the sensitivity as a function of 1-specificity
library(pROC)
par(pty="s")
Roc <- roc(response,mod1$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.4,y=0.95,labels = "Sensitivity")
text(x=0.4,y=0.09,labels = "Specificity")
abline(v=0.784,col="red",lty=2)
# Let us now use the value of the new cut point to make predictions
cp<-0.784
prediction <- ifelse(mod1$fitted.values < cp,0,1)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
abline(v=0.76,col="red",lty=2)
abline(v=0.77,col="red",lty=2)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.4,y=0.95,labels = "Sensitivity")
text(x=0.4,y=0.09,labels = "Specificity")
abline(v=0.77,col="red",lty=2)
# Let us now use the value of the new cut point to make predictions
cp<-0.77
prediction <- ifelse(mod1$fitted.values < cp,0,1)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol+Age, data = d1, family = binomial())
mod1 #No observation is deleted
#Let's checkout the Wald Tests.
summary(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# we can obtain the exponentials simply by
exp(mod1$coefficients)
# HOSMER-LEMESHOW TEST
# install the package first
# install.packages("ResourceSelection")
library(ResourceSelection)
# Let's obtain the pvalue
hoslem.test(d1$Smoker,mod1$fitted.values)
# CLASSIFICATION TABLE
# The table is produced with two variables: data of the response and predictions
# The response is:
response <- d1$Smoker
# In order to compute our predictions we need to fix the cut point
# Let's select cp=0.5
cp<-0.5
# Let us now use the cut point to obtain our predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
# We can now create the table
library(caret)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
# ROC
# The ROC curve is plot of the sensitivity as a function of 1-specificity
library(pROC)
par(pty="s")
Roc <- roc(response,mod1$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.13,labels = "Sensitivity")
text(x=0.7,y=0.9,labels = "Specificity")
abline(v=0.412,col="red",lty=2)
abline(v=0.43,col="red",lty=2)
abline(v=0.44,col="red",lty=2)
cp = 0.435
# Let us now use the value of the new cut point to make predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
#Let's checkout the Wald Tests.
summary(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# we can obtain the exponentials simply by
exp(mod1$coefficients)
# HOSMER-LEMESHOW TEST
# install the package first
# install.packages("ResourceSelection")
library(ResourceSelection)
# Let's obtain the pvalue
hoslem.test(d1$Smoker,mod1$fitted.values)
# CLASSIFICATION TABLE
# The table is produced with two variables: data of the response and predictions
# The response is:
response <- d1$Smoker
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
#Let's checkout the Wald Tests.
summary(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# we can obtain the exponentials simply by
exp(mod1$coefficients)
mod1 <- glm(PhysActivity ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
pacman::p_load(
tidyverse,
dplyr
)
d1 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 1/diabetes_d1.csv")
print(nrow(d1))
mod1 <- glm(PhysActivity ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
#Let's checkout the Wald Tests.
summary(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
#Firs Model: Outcome
# Load the data
d3 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 3/diabetes_d3.csv")
# We delete outliers (explained in Report 1)
d3<- d3 %>% filter(BloodPressure > 0,BMI > 0, Glucose > 0, Insulin > 0, SkinThickness > 0)
# Let's see the first observations
head(d3)
#
table(d3$Outcome)
# Model selection
mod2 <- glm(Outcome ~ Glucose+BMI+DiabetesPedigreeFunction+Age, data = d3, family = binomial())
# Likelihood ratio test to compare mod1 and mod2
lambda <- mod2$deviance - mod1$deviance
dof <- mod2$df.residual - mod1$df.residual
p_value <- pchisq(lambda, df = dof, lower.tail = FALSE)
p_value
# Model selection
mod2 <- glm(Outcome ~ Glucose+BMI+DiabetesPedigreeFunction+Age, data = d3, family = binomial())
# Likelihood ratio test to compare mod1 and mod2
lambda <- mod2$deviance - mod1$deviance
dof <- mod2$df.residual - mod1$df.residual
p_value <- pchisq(lambda, df = dof, lower.tail = FALSE)
p_value
pacman::p_load(
tidyverse,
dplyr,
ResourceSelection, # for Hosmer-Lemeshow test
caret, # for confusionMatrix
pROC # for roc
)
#Firs Model: Outcome
# Load the data
d3 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 3/diabetes_d3.csv")
# We delete outliers (explained in Report 1)
d3<- d3 %>% filter(BloodPressure > 0,BMI > 0, Glucose > 0, Insulin > 0, SkinThickness > 0)
# Let's see the first observations
head(d3)
#Count the number of observations of Outcome
table(d3$Outcome)
# LOGISTIC REGRESSION
# First model
mod1 <- glm(Outcome ~ Pregnancies+Glucose+BloodPressure+SkinThickness+
Insulin+BMI+Age+DiabetesPedigreeFunction, data = d3, family = binomial())
mod1 #No observation is deleted
#Performing Wald Test
summary(mod1)
# Confidence intervals
confint(mod1)
# Model selection
mod2 <- glm(Outcome ~ Glucose+BMI+DiabetesPedigreeFunction+Age, data = d3, family = binomial())
# Likelihood ratio test to compare mod1 and mod2
lambda <- mod2$deviance - mod1$deviance
dof <- mod2$df.residual - mod1$df.residual
p_value <- pchisq(lambda, df = dof, lower.tail = FALSE)
p_value
#Now another test is going to be conducted to study the inclusion of Age
summary(mod2)
#Regarding Wald Test, Age is signicant in the model
#Let's see the results of the Likelihood Ratio Test
mod3 <- glm(Outcome ~ Glucose+BMI+DiabetesPedigreeFunction, data = d3, family = binomial())
install.packages("pacman")
#install.packages("pacman")
pacman::p_load(
tidyverse,
dplyr,
ResourceSelection, # for Hosmer-Lemeshow test
caret, # for confusionMatrix
pROC # for roc
)
#Firs Model: Outcome
# Load the data
d3 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 3/diabetes_d3.csv")
# We delete outliers (explained in Report 1)
d3<- d3 %>% filter(BloodPressure > 0,BMI > 0, Glucose > 0, Insulin > 0, SkinThickness > 0)
# Let's see the first observations
head(d3)
#Count the number of observations of Outcome
table(d3$Outcome)
# LOGISTIC REGRESSION
# First model
mod1 <- glm(Outcome ~ Pregnancies+Glucose+BloodPressure+SkinThickness+
Insulin+BMI+Age+DiabetesPedigreeFunction, data = d3, family = binomial())
mod1 #No observation is deleted
#Performing Wald Tests
summary(mod1)
# Confidence intervals
confint(mod1)
# Model selection
mod2 <- glm(Outcome ~ Glucose+BMI+DiabetesPedigreeFunction+Age, data = d3, family = binomial())
# Likelihood ratio test to compare mod1 and mod2
lambda <- mod2$deviance - mod1$deviance
dof <- mod2$df.residual - mod1$df.residual
pchisq(lambda, df = dof, lower.tail = FALSE)
#Now another test is going to be conducted to study the inclusion of Age
summary(mod2)
#Regarding Wald Test, Age is signicant in the model
#Let's see the results of the Likelihood Ratio Test, comparing mod2 and mod3
#First we build mod3 not including age
mod3 <- glm(Outcome ~ Glucose+BMI+DiabetesPedigreeFunction, data = d3, family = binomial())
lambda <- mod3$deviance - mod2$deviance
dof <- mod3$df.residual - mod2$df.residual
pchisq ( lambda ,df= dof , lower.tail = FALSE )
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod2$coefficients
# HOSMER-LEMESHOW TEST
hoslem.test(d3$Outcome,mod2$fitted.values)
# ROC
# The ROC curve is plot of the sensitivity as a function of 1-specificity
response <- d3$Outcome
par(pty="s")
Roc <- roc(response,mod2$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
optimal_cut <- coords(Roc, "best", best.method = "closest.topleft")
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.05,labels = "Sensitivity")
text(x=0.7,y=0.85,labels = "Specificity")
abline(v=0.315,col="red",lty=2)
cp = 0.315
# Let us now use the value of the new cut point to make predictions
prediction <- ifelse(mod2$fitted.values < cp,0,1)
# We can now create the confusion matrix to study accuracy, sensitivity and specificity
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
#Deletion of the variables used before in order not make mistakes
rm(list=ls())
# Load the data
d1 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 1/diabetes_d1.csv")
#First Model
mod1 <- glm(PhysActivity ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
# Let's see the first observations
head(d1)
# Load the data
d1 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 1/diabetes_d1.csv")
# Let's see the first observations
head(d1)
#First Model
mod1 <- glm(PhysActivity ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
#Performing Wald Tests
summary(mod1)
#Deletion of the variables used before in order not make mistakes
rm(list=ls())
# Load the data
d1 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 1/diabetes_d1.csv")
# Let's see the first observations
head(d1)
#First Model
mod1 <- glm(PhysActivity ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
#Performing Wald Tests
summary(mod1)
# Confidence intervals
confint(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# HOSMER-LEMESHOW TEST
hoslem.test(d1$PhysActivity,mod1$fitted.values)
# ROC
# The ROC curve is plot of the sensitivity as a function of 1-specificityç
response <- d1$PhysActivity
par(pty="s")
Roc <- roc(response,mod1$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.4,y=0.95,labels = "Sensitivity")
text(x=0.4,y=0.09,labels = "Specificity")
abline(v=0.784,col="red",lty=2)
cp<-0.784
# Let us now use the value of the new cut point to make predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
# We can now create the confusion matrix to study accuracy, sensitivity and specificity
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
#Deletion of the variables used before in order not make mistakes
rm(list=ls())
# Load the data
d1 <- read.csv("DESCRIPTIVE ANALYSIS/DATASET 1/diabetes_d1.csv")
# Let's see the first observations
head(d1)
#First Model
mod1 <- glm(Smoker ~ Diabetes_012+Stroke+HvyAlcoholConsump+Fruits+Veggies
+HighBP+HighChol, data = d1, family = binomial())
mod1 #No observation is deleted
#Performing Wald Tests.
summary(mod1)
# Confidence intervals
confint(mod1)
# COEFFICIENT INTERPRETRATION
# A look to the coefficients
mod1$coefficients
# HOSMER-LEMESHOW TEST
hoslem.test(d1$Smoker,mod1$fitted.values)
# ROC
# The ROC curve is plot of the sensitivity as a function of 1-specificity
response <- d1$Smoker
par(pty="s")
Roc <- roc(response,mod1$fitted.values,plot=TRUE,legacy.axes=TRUE,print.auc=TRUE)
# OPTIMAL CUT POINT
# The optimal cut point can be obtained from the point the sensitivity and the specificity curves cross
plot(Roc$thresholds,Roc$sensitivities,type="l",xlab="Cut points",ylab="Sensitivity/Specificity",bty="n")
lines(Roc$thresholds,Roc$specificities)
text(x=0.7,y=0.13,labels = "Sensitivity")
text(x=0.7,y=0.9,labels = "Specificity")
abline(v=0.412,col="red",lty=2)
cp = 0.412
# Let us now use the value of the new cut point to make predictions
prediction <- ifelse(mod1$fitted.values < cp,0,1)
# We can now create the confusion matrix to study accuracy, sensitivity and specificity
tab<-confusionMatrix(as.factor(prediction),as.factor(response),positive="1")
tab
#Accuracy = 0.5698
#Accuracy = 0.5698
#Sensitivity = 0.5798
